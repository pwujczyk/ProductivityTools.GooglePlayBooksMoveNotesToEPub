


function createHighlightsFile(bookNotesFolder, name) {
  var bookTitle = getBookTitle(name)
  var highlightsName = "Highlights from: " + bookTitle;
  var doc = DocumentApp.create(highlightsName);
  docFile = DriveApp.getFileById(doc.getId());
  bookNotesFolder.addFile(docFile);
  return doc;
}

function getBookTitle(documentName) {
  if (name.includes("Notatki")) {
    var startPosition = name.indexOf("â€ž")
    var bookName = name.substring(startPosition + 1, name.length - 1)
  }
  else {
    var startPosition = name.indexOf("\"")
    var bookName = name.substring(startPosition + 1, name.length - 1)
  }
  return bookName;
}


function processDokument(sourceDoc, highlightsDoc) {

  var highlightsBody = highlightsDoc.getBody();

  var doc = DocumentApp.openById(sourceDoc.getId());
  var name = doc.getName();
  var bookName = getBookTitle(name);
  var header = highlightsBody.appendParagraph(bookName);
  header.setHeading(DocumentApp.ParagraphHeading.HEADING1);

  var paragraphs = doc.getParagraphs();

  for (var i = 1; i < paragraphs.length; i++) {
    var paragraphText = paragraphs[i].getText();
    console.log(paragraphText);
    var paragraphAtributes = paragraphs[i].getAttributes();

    if (paragraphAtributes.FONT_SIZE == 16 && paragraphText != "") {
      var p = paragraphs[i].copy();
      // highlightsBody.appendParagraph(p);
      //var item1 = highlightsBody.appendListItem(paragraphText).setGlyphType(DocumentApp.GlyphType.BULLET);
      var header = highlightsBody.appendParagraph(p);
      header.setHeading(DocumentApp.ParagraphHeading.HEADING2);
    }

    if (paragraphAtributes.BACKGROUND_COLOR == "#fde096" && paragraphText != "") {
      var item1 = highlightsBody.appendListItem(paragraphText).setGlyphType(DocumentApp.GlyphType.BULLET);
    }
  }
}

function processDirectory() {
  var bookNotesFolder = DriveApp.getFoldersByName("Book notes").next();
  var files = bookNotesFolder.getFiles()
  while (files.hasNext()) {
    file = files.next();
    name = file.getName();
    console.log(name);

    highlightsDoc = createHighlightsFile(bookNotesFolder, name);
    processDokument(file, highlightsDoc);
    break;
  }

}

function myFunction() {
  processDirectory();
}
