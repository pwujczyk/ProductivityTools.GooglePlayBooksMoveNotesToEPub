


function createHighlightsFile(bookNotesFolder, name) {
  var bookTitle = getBookTitle(name)
  var highlightsName = "Highlights from: " + bookTitle;
  var doc = DocumentApp.create(highlightsName);
  docFile = DriveApp.getFileById(doc.getId());
  bookNotesFolder.addFile(docFile);
  return doc;
}

function getBookTitle(documentName) {
  if (name.includes("Notatki")) {
    var startPosition = name.indexOf("â€ž")
    var bookName = name.substring(startPosition + 1, name.length - 1)
  }
  else {
    var startPosition = name.indexOf("\"")
    var bookName = name.substring(startPosition + 1, name.length - 1)
  }
  return bookName;
}

//function appendBullet(body,paragraph)

function processDokument(sourceDoc, highlightsDoc) {
  var doc = DocumentApp.openById(sourceDoc.getId());
  var body = doc.getBody().getText();
  var x = doc.getHeader();
  var name = doc.getName();
  var bookName = getBookTitle(name);

  var paragraphs = doc.getParagraphs();
  var resultParagraphts = []
  var subject = "";
  var highlightsBody = highlightsDoc.getBody();
  highlightsBody.appendParagraph("dzilam");
  highlightsBody.appendPageBreak();
  var item1 = highlightsBody.appendListItem('Item 1').setGlyphType(DocumentApp.GlyphType.BULLET);

  for (var i = 1; i < paragraphs.length; i++) {
    var paragraphText = paragraphs[i].getText();
    console.log(paragraphText);
    var paragraphAtributes = paragraphs[i].getAttributes();
    // if (paragraphAtributes.FONT_SIZE == 16 && paragraphText != "" && resultString != "") {
    //   console.log("Publishing the chapter")
    //   console.log(resultString);
    //    var p=paragraphs[i].copy();
    //   var header=highlightsBody.appendParagraph(p);
    //   header.setHeading(DocumentApp.ParagraphHeading.HEADING1);

    //   resultString = ""
    // }

    if (paragraphAtributes.FONT_SIZE == 16 && paragraphText != "") {
      subject = paragraphText;
      var p = paragraphs[i].copy();
      // highlightsBody.appendParagraph(p);
      var item1 = highlightsBody.appendListItem(paragraphText).setGlyphType(DocumentApp.GlyphType.BULLET);
      var header = highlightsBody.appendParagraph(p);
      header.setHeading(DocumentApp.ParagraphHeading.HEADING1);
      //      resultString = getOpening(subject);
    }

    if (paragraphAtributes.BACKGROUND_COLOR == "#fde096" && paragraphText != "") {
      //console.log(x);
      //console.log(z.BACKGROUND_COLOR)
      resultParagraphts.push(paragraphText);
      var p = paragraphs[i].copy();
      //      highlightsBody.appendParagraph(p);
      var item1 = highlightsBody.appendListItem(paragraphText).setGlyphType(DocumentApp.GlyphType.BULLET);
    }
  }
  //CreateJournal(bookName,resultString)
  //pushParagraphsToJournalApi(bookName,resultString);

}

function processDirectory() {
  var bookNotesFolder = DriveApp.getFoldersByName("Book notes").next();
  var files = bookNotesFolder.getFiles()
  while (files.hasNext()) {
    file = files.next();
    name = file.getName();
    console.log(name);

    highlightsDoc = createHighlightsFile(bookNotesFolder, name);
    processDokument(file, highlightsDoc);
    break;
  }


}

function myFunction() {
  processDirectory();
}
